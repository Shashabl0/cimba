<!DOCTYPE html>
<html lang="en" ng-app="CimbaApp">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
<meta charset="utf-8">
<title>Cimba</title>
<meta name="generator" content="Cimba">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!-- prod
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" rel="stylesheet">
<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">
-->
<!-- dev -->
<link href="dev/css/bootstrap.min.css" rel="stylesheet">
<link href="dev/css/font-awesome.min.css" rel="stylesheet">
<!-- local -->
<link href="css/style.css" rel="stylesheet">
<link href="css/proxima-nova.css" rel="stylesheet">


<!-- prod
<script type='text/javascript' src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type='text/javascript' src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.js"></script>
-->
<!-- dev -->
<script type='text/javascript' src="dev/js/jquery.min.js"></script>
<script type='text/javascript' src="dev/js/bootstrap.min.js"></script>
<script type="text/javascript" src="dev/js/jquery-ui.js"></script>

<script src="dev/js/angular.min.js"></script>
<script src="dev/js/angular-ui.min.js"></script> 
<!-- local -->
<script type='text/javascript' src="js/jquery.notify.js"></script>
<script type='text/javascript' src="js/rdflib.min.js"></script>
<script type='text/javascript' src="js/common.js"></script>
<script type="text/javascript" src="js/moment.min.js"></script>
<script type='text/javascript' src="js/app.js"></script>

<!--[if lt IE 9]>
  <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
    
<link rel="shortcut icon" type="img/png" href="favicon.png">
</head>
    
<body>
<div ng-controller="CimbaCtrl">
    <div ng-cloak class="navbar navbar-default" id="subnav">
        <div class="col-md-12">
            <div class="navbar-header">
                <img src="img/cimba-logo.png" class="logo">                
                <button id="menuToggle" type="button" class="navbar-toggle pull-right" data-toggle="collapse" data-target="#navbar-collapse2">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
<!-- TODO!
                <div ng-show="user.mypic" class="user-thumb"><a href="{{user.webid}}" target="_blank"><img class="r3" src="{{user.mypic}}" rel="tooltip" data-placement="top" title="{{user.myname}}"></a></div>
-->
            </div>

            <div class="collapse navbar-collapse" id="navbar-collapse2">
              <ul class="nav navbar-nav navbar-right">
                  <li class="active"><a href="#"><span class="icon-home"></span> Home</a></li>
                  <li ng-show="loggedin"><a href="#subsModal" role="button" data-toggle="modal"><span class="icon-rss"></span> Channels</a></li>
                  <li ng-hide="!user.channels[0]"><a href="#" ng-click="updatePosts()"><i class="icon-refresh"></i> Refresh </a></li>
                  <li ng-hide="loggedin"><a href="#loginModal" role="button" data-toggle="modal"><span class="icon-signin"></span> Login</a></li>
                  <li ng-show="loggedin"><a href="#" ng-click="clearSession()" role="button"><span class="icon-signout"></span> Logout</a></li>
              </ul>
            </div>
        </div>	
    </div>

    <!--main-->

    <!-- new post  -->
    <div class="container" id="newpost">
        <div class="row">
            <div class="clear-70"></div>
            <div class="col-md-12">
                <!-- new post -->
                <div class="panel panel-default" ng-show="loggedin"> 
                    <div class="panel-heading dark-blue">
                        <div class="pull-left">
                            <a id="mypic" class="thumbnail pull-right" href="#">
                              <img class="media-object" src="img/photo.png" rel="tooltip" data-placement="top" title="Name">
                            </a>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="panel-body-textmail">
                          <div id="spinner" ng-hide="user.myname"></div>
                          <h3 class="bold" ng-show="profileloading">Loading profile...</h3>
                          <h3 class="bold" ng-show="user.myname && !user.chspace">Hello {{user.myname}}...</h3>
                          <h3 class="bold" ng-show="user.myname && user.chspace">What's new, {{user.myname}}?</h3>
                          <form ng-hide="user.webid && !user.chspace">                               
                              <textarea name="message" ng-model="postbody" class="form-control message" placeholder="Type your message here.." required></textarea>
                              <div class="btn-group">
                                  <button id="audience" ng-model="audience" class="btn btn-classic"><i class="{{audience}} icon-2x blue"></i></button><button class="btn dropdown-toggle" data-toggle="dropdown" data-target="#" href="#"> <small class="drop" rel="tooltip" data-placement="top" title="Audience"><i class="icon-chevron-down icon-2x"></i></small></button>
                                  <ul class="dropdown-menu" role="menu" aria-labelledby="audience">
                                      <li><a href="#" ng-click="setAudience('public')"><i id="public" class="icon-globe icon-2x blue"></i> Public</a></li>
                                      <li><a href="#" ng-click="setAudience('private')">&nbsp;<i id="private" class="icon-lock icon-2x blue"></i>&nbsp; Private</a></li>
                                      <li><a href="#" ng-click="setAudience('friends')"><i id="friends" class="icon-user icon-2x blue"></i> Friends</a></li>
                                  </ul>
                              </div>
                              <div class="btn-group" ng-show="user.channels.length > 0" rel="tooltip" data-placement="top" title="Channels">
                                  <button id="chs" class="btn btn-classic dropdown-toggle" data-toggle="dropdown" data-target="#" href="#">{{defaultChannel.title}}</button>
                                  <ul class="dropdown-menu" role="menu" aria-labelledby="chs">
                                      <li ng-repeat="channel in user.channels">
                                          <a href="#" ng-click="setChannel(channel.title)">{{channel.title}}</a>
                                      </li>
                                  </ul>
                              </div>
                              <div class="pull-right">
                                  <button class="btn btn-primary pull-right w60" ng-click="newPost()" ng-disabled="!postbody">
                                    <div ng-show="!publishing">Post</div>
                                    <div ng-show="publishing" class="dots"></div>
                                  </button>
                              </div>
                          </form>
                        </div>
                    </div>
                </div>
                <!-- end new post -->
            </div>
        </div>
    </div>
    
    <!-- WebID authentication failed/missing -->
    <div id="setup" class="container" ng-show="testwebid">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default"> 
                    <div class="panel-heading dark-blue">
                      &nbsp;
                    </div>
                    <div class="panel-body">
                        <div class="panel-body">
                          <h2 class="text-center">Oh snap, cannot authentify you using WebID-TLS!</h2>
                          <div class="text-center">
                            <a href="https://auth.my-profile.eu/auth/index.php?verbose=on" target="_blank"><button class="btn btn-primary btn-sep-right">Test your WebID</button></a>
                            <a href="#loginModal" role="button" data-toggle="modal"><button class="btn btn-primary">Sign up for a WebID</button></a>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- login/signup -->
    <div id="setup" class="container" ng-show="!user.webid">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default"> 
                    <div class="panel-heading dark-blue">
                      &nbsp;
                    </div>
                    <div class="panel-body">
                        <div class="panel-body">
                          <h2 class="text-center">Welcome to <img src="img/cimba-logo.png" height="50"></h2>
                          <div class="text-center">
                            <h3>You must be authenticated in order to use this uBlogging application.</h3>
                            <a href="#loginModal" role="button" data-toggle="modal"><button class="btn btn-primary btn-sep-right">Login / Sign Up</button></a>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- new storage modal -->
    <div id="setup" class="container" ng-show="user.webid && !user.storagespace">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <h3 class="text-center">Oh snap, I could not find a shared storage space! <a href="#newStorageModal" role="button" data-toggle="modal"><button class="btn btn-primary">Please provide one here</button></a></h3>
                </div>
            </div>
        </div>
    </div>

    <!-- new uB modal -->
    <div id="setup" class="container" ng-show="user.webid && user.storagespace && !user.mbspace">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <h3 class="text-center">Oh snap, I could not find a uBlog space! <a href="#newMBModal" role="button" data-toggle="modal"><button class="btn btn-primary">Click here to create one</button></a></h3>
                </div>
            </div>
        </div>
    </div>

    <!-- new channel modal -->
    <div id="setup" class="container" ng-show="user.webid && user.storagespace && user.mbspace && !user.channels">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <h3 class="text-center">Oh snap, you don't have any uBlog channels! <a href="#newChannelModal" role="button" data-toggle="modal"><button class="btn btn-primary">Click here to create a channel</button></a></h3>
                </div>
            </div>
        </div>
    </div>

    <!-- posts viewer -->
    <div id="posts" class="container">
        <div class="row">
            <div class="col-md-12">
                <!-- All posts go into <posts-viewer> -->
                <posts-viewer ng-show="loggedin"></posts-viewer>
                <div class="panel panel-default" ng-show="loading">
                    <div id="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!--new storage modal-->
    <div id="newStorageModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                  <h3 class="text-center">Provide a URI for your storage</h3>
              </div>
              <div class="modal-body">
                  <form class="m10">
                      <input type="text" id="storageuri" name="storageuri" ng-model="storageuri" class="" placeholder="Storage URI.." required>
                  </form>
                  <div ng-show="storageuri" class="text-center">
                  <p>Alternatively, after providing the storage URI, you can manually add the following triple to your WebID profile:</p>
                  <pre><code>&lt;{{user.webid}}&gt;
    &lt;http://www.w3.org/ns/pim/space#storage&gt;
        &lt;{{storageuri}}&gt; .
                  </code></pre>
                  </div>
              </div>
              <div class="modal-footer">
                  <div class="col-md-12">
                      <button class="btn btn-info btn-sep-right" data-dismiss="modal" aria-hidden="true">Close</button>
                      <button class="btn btn-primary" ng-click="newStorage()" ng-disabled="!storageuri">{{addstoragebtn}}</button>
                  </div>  
              </div>      
          </div>
      </div>
    </div>

    <!--new microblogging workspace modal-->
    <div id="newMBModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">                 
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>              
                  <h3 class="text-center">Create a new uBlog workspace</h3>
              </div>
              <div class="modal-body">
                  <form class="m10">
                      <input type="text" id="mburi" name="mburi" ng-model="mburi" class="" placeholder="mb, ublog, etc.." required>
                  </form>
              </div>
              <div class="modal-footer">
                  <div class="col-md-12">
                      <button class="btn btn-info btn-sep-right" data-dismiss="modal" aria-hidden="true">Close</button>
                      <button class="btn btn-primary" ng-click="newMB()" ng-disabled="!mburi">{{createbtn}}</button>
                  </div>  
              </div>
          </div>
      </div>
    </div>

    <!--new channel modal-->
    <div id="newChannelModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                  <h2 class="text-center">Create a new channel</h2>
              </div>
              <div class="modal-body">
                  <form class="m10">
                  <p>The name you provide will be used to create a new channel inside your uBlog workspace.</p>
                  <p><input type="text" id="channeluri" name="channeluri" ng-model="channeluri" class="" placeholder="Name (ch, default, etc.).." required></p>
                  <p><input type="text" id="channeltitle" name="channeltitle" ng-model="channeltitle" class="" placeholder="Title (Main, Work, etc.).." required></p>
                  </form>
              </div>
              <div class="modal-footer">
                  <div class="col-md-12">
                      <button class="btn btn-info btn-sep-right" data-dismiss="modal" aria-hidden="true">Close</button>
                      <button class="btn btn-primary" ng-click="newChannel()" ng-disabled="!channeluri || !channeltitle">{{createbtn}}</button>
                  </div>  
              </div>
          </div>
      </div>
    </div>

    <!--login modal-->
    <div id="loginModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h2 class="text-center">Login / Sign Up</h2>
          </div>
          <div class="modal-body">
              <!-- <div id="login-body"></div> -->
              
              <iframe id="signup" src="" sandbox="allow-same-origin allow-scripts allow-forms" frameborder="0" width="390" height="430"></iframe>
              
          </div>
          <div class="modal-footer">
              <div class="col-md-12">
                  <button class="btn btn-info" data-dismiss="modal" aria-hidden="true">Close</button>
              </div>  
          </div>
      </div>
      </div>
    </div>

    <!--subscriptions modal-->
    <div id="subsModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h2 class="text-center"><span class="icon-rss"></span>  Manage channels</h2>
                    <a href="#newChannelModal" role="button" data-toggle="modal" onclick="$('#subsModal').modal('hide')"><button class="btn btn-info btn-sep-right"><i class="icon-rss"></i> New channel</button></a>
                    <a href="#subscribeModal" role="button" data-toggle="modal" onclick="$('#subsModal').modal('hide')"><button class="btn btn-info btn-sep-right"><i class="icon-search"></i> Search by WebID</button></a>
                </div>
                <div class="modal-body">
                    <channelsList></channelsList>
                </div>
                <div class="modal-footer">
                    <div class="col-md-12">
                        <button class="btn btn-info btn-sep-right" data-dismiss="modal" aria-hidden="true">Close</button>
                        <button class="btn btn-primary" ng-click="getInfo(searchwebid)" ng-disabled="!searchwebid"><i class="icon-search"></i> {{searchbtn}}</button>
                    </div>  
                </div>
            </div>
        </div>
    </div>

    <!--subscribe modal-->
    <div id="subscribeModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h2 class="text-center"><i class="icon-search"></i> Find channels</h2>
                    <form>
                        <p>Please provide the channel owner's WebID.</p>
                        <p><input type="text" id="searchwebid" name="searchwebid" ng-model="searchwebid" autofocus required></p>
                    </form>
                </div>
                <div class="modal-body">
                    <div class="searchresults" ng-show="gotresults">
                        <div class="panel-heading dark-blue">
                            <div class="pull-left">
                                <a class="thumbnail thumbnail-sm pull-right" href="#">
                                  <img class="media-object" src="{{search.pic}}" rel="tooltip" data-placement="top" title="{{search.name}}">
                                </a>
                            </div>
                        </div>
                        <div class="panel-body-text">
                            <h4 class="black bold">{{search.name}}</h4>
                            <h4 class="black">Has {{search.channels.length}} channels.</h4>
                        </div>
                        <div class="panel-body">
                            <h4 class="black" ng-repeat="ch in search.channels">
                                <button class="btn" ng-class="ch.selected" ng-click="channelToggle(ch)">{{ch.status}}</button>
                                <a href="{{ch.uri}}" target="_blank">{{ch.title}}</a>
                            </h4>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="col-md-12">
                        <button class="btn btn-info btn-sep-right" data-dismiss="modal" aria-hidden="true">Close</button>
                        <button class="btn btn-primary" ng-click="getInfo(searchwebid)" ng-disabled="!searchwebid"><i class="icon-search"></i> {{searchbtn}}</button>
                    </div>  
                </div>
            </div>
        </div>
    </div>

</div>
<!-- bottom -->
<div class="col-md-12 text-center">
    <hr>
    <p>Powered by <a href="https://github.com/social-webarch/cimba" target="_blank">CIMBA</a> v1.0 alpha</p>
</div>
<!--/main-->

<!-- set the notifications container hidden when the page first loads -->
<div id="notification" style="display:none">
    <div id="basic-template">
        <a class="ui-notify-cross ui-notify-close" href="#">x</a>
        <h1>#{title}</h1>
        <p>#{text}</p>
    </div>
</div>



<!--about modal-->
<div id="aboutModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
  <div class="modal-content">
      <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          <h2 class="text-center">About</h2>
      </div>
      <div class="modal-body">
          <div class="col-md-12 text-center">
            <h3>This uBlog app is powered by <a href="#">Cimba v1.0 alpha</a></h3>
            <br>UI design by <a href="#">Andrei Sambra</a>
            <br><br>
            <a href="#">GitHub Fork</a>
          </div>
      </div>
      <div class="modal-footer">
          <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
      </div>
  </div>
  </div>
</div>

<script type='text/javascript'>
$(document).ready(function() {
    /* toggle layout */
    $('#btnToggle').click(function(){
        if ($(this).hasClass('on')) {
            $('#main .col-md-6').addClass('col-md-4').removeClass('col-md-6');
            $(this).removeClass('on');
        }
        else {
            $('#main .col-md-4').addClass('col-md-6').removeClass('col-md-4');
            $(this).addClass('on');
        }
    });
    // auto close menu after click
    $('#navbar-collapse2').click(function () {
        if (!$("#menuToggle").hasClass('collapsed')) {
            $('.navbar-collapse').collapse('hide');
        }
    });

    // load login/signup
    //$('#login-body').load("//example.org/onboard/signup.html");
    //angular.bootstrap(document.getElementById('ob-app'), ['ob-app']);

    // init tooltip plugin
    $('#audience').tooltip();

    var providerURI = '//linkeddata.github.io/signup/index.html?ref=';
    // set the parameter in the src of iframe
    document.getElementById('signup').src = providerURI+window.location.protocol+'//'+window.location.host;
    //document.getElementById('directLogin').href = providerURI+window.location.protocol+'//'+window.location.host+'#login';
    //document.getElementById('directSignup').href = providerURI+window.location.protocol+'//'+window.location.host+'#signup';
});
</script>

</body>
</html>
